<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <title></title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-image: url('img/4028_B #1616580.png');
        background-position: center center;
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
        min-height: 100vh;
        color: #333;
        -webkit-overflow-scrolling: touch;
        overflow-x: hidden;
        position: relative;
      }

      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.4);
        pointer-events: none;
        z-index: 0;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        padding: 40px;
        border-radius: 24px;
        box-shadow: 
          0 20px 60px rgba(0, 0, 0, 0.15),
          0 0 0 1px rgba(255, 255, 255, 0.1) inset;
        backdrop-filter: blur(25px) saturate(200%);
        animation: fadeIn 0.5s ease-in;
        position: relative;
        z-index: 1;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        text-align: center;
        color: #667eea;
        font-size: 2.8em;
        margin-bottom: 45px;
        font-weight: 800;
        letter-spacing: -0.5px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        position: relative;
        padding-bottom: 20px;
      }

      h1::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 4px;
        background: linear-gradient(90deg, transparent, #667eea, transparent);
        border-radius: 2px;
      }

      .section {
        margin-bottom: 35px;
        padding: 28px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.75) 0%, rgba(248, 250, 252, 0.75) 100%);
        border-radius: 18px;
        box-shadow: 
          0 8px 24px rgba(0, 0, 0, 0.15),
          0 0 0 1px rgba(102, 126, 234, 0.1) inset;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(102, 126, 234, 0.15);
        backdrop-filter: blur(12px) saturate(140%);
      }

      .section:hover {
        transform: translateY(-3px);
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.85) 0%, rgba(248, 250, 252, 0.85) 100%);
        box-shadow: 
          0 12px 32px rgba(0, 0, 0, 0.2),
          0 0 0 1px rgba(102, 126, 234, 0.2) inset;
        border-color: rgba(102, 126, 234, 0.25);
      }

      h2 {
        color: #1a202c;
        border-bottom: 3px solid transparent;
        border-image: linear-gradient(90deg, #667eea 0%, #764ba2 100%) 1;
        padding-bottom: 14px;
        margin-bottom: 24px;
        font-size: 1.6em;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: space-between;
        letter-spacing: -0.3px;
        position: relative;
      }

      h2::after {
        content: '';
        position: absolute;
        bottom: -3px;
        left: 0;
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 2px;
      }

      .role-icon {
        width: 56px;
        height: 56px;
        object-fit: contain;
        margin-right: 16px;
        flex-shrink: 0;
        transition: all 0.3s ease;
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        position: relative;
      }

      .role-icon:hover {
        transform: scale(1.15) rotate(5deg);
        filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.3));
      }

      .role-title-text {
        display: inline-flex;
        align-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 800;
        letter-spacing: 0.5px;
      }

      .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .checkbox-item {
        display: flex;
        align-items: flex-start;
        padding: 12px 16px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.7) 0%, rgba(249, 250, 251, 0.7) 100%);
        border-radius: 14px;
        box-shadow: 
          0 4px 12px rgba(0, 0, 0, 0.1),
          0 0 0 1px rgba(102, 126, 234, 0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2px solid transparent;
        cursor: pointer;
        position: relative;
        touch-action: manipulation;
        user-select: none;
        -webkit-user-select: none;
        backdrop-filter: blur(10px) saturate(130%);
        overflow: hidden;
      }

      .checkbox-item::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background: transparent;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 14px 0 0 14px;
      }

      .checkbox-item.selected::before {
        background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 0 8px rgba(102, 126, 234, 0.5);
      }

      .checkbox-item.selected {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.05) 100%);
        border-color: rgba(102, 126, 234, 0.3);
        box-shadow: 
          0 4px 12px rgba(102, 126, 234, 0.15),
          0 0 0 2px rgba(102, 126, 234, 0.2);
      }

      .checkbox-item:hover {
        transform: translateY(-4px);
        box-shadow: 
          0 8px 20px rgba(102, 126, 234, 0.25),
          0 0 0 2px rgba(102, 126, 234, 0.2);
        border-color: rgba(102, 126, 234, 0.3);
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.85) 0%, rgba(252, 253, 255, 0.85) 100%);
      }

      .checkbox-item.selected:hover {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.12) 0%, rgba(118, 75, 162, 0.08) 100%);
      }

      .role-check-indicator {
        display: none;
      }

      .checkbox-item.selected .role-check-indicator {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-color: #667eea;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        transform: scale(1.1);
      }

      .role-check-indicator::after {
        content: 'âœ“';
        color: white;
        font-size: 14px;
        font-weight: bold;
        transform: scale(0);
        transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        position: absolute;
        line-height: 1;
      }

      .checkbox-item.selected .role-check-indicator::after {
        transform: scale(1);
      }

      .checkbox-item label {
        cursor: pointer;
        font-weight: 600;
        color: #2d3748;
        font-size: 1.3em;
        flex: 1;
        line-height: 1.4;
      }


      .role-info, .demand-info {
        font-size: 0.85em;
        color: #718096;
        margin-top: 4px;
        line-height: 1.5;
        display: block;
        width: 100%;
      }

      .role-avatar {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 10px;
        border: 2px solid rgba(102, 126, 234, 0.2);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
      }


      .demand-info {
        padding-left: 32px;
      }

      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 18px 48px;
        border: none;
        border-radius: 16px;
        cursor: pointer;
        font-size: 1.15em;
        font-weight: 700;
        margin: 35px auto;
        display: block;
        box-shadow: 
          0 8px 24px rgba(102, 126, 234, 0.35),
          0 0 0 1px rgba(255, 255, 255, 0.1) inset;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-transform: uppercase;
        letter-spacing: 1.5px;
        touch-action: manipulation;
        -webkit-tap-highlight-color: rgba(102, 126, 234, 0.3);
        min-height: 56px;
        position: relative;
        overflow: hidden;
      }

      button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.6s;
      }

      button:hover::before {
        left: 100%;
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 
          0 12px 32px rgba(102, 126, 234, 0.45),
          0 0 0 1px rgba(255, 255, 255, 0.15) inset;
      }

      button:active {
        transform: translateY(-1px);
      }

      #selectAllRoles, #deselectAllRoles {
        padding: 8px 20px;
        font-size: 0.85em;
        font-weight: 700;
        margin: 0 6px;
        text-transform: none;
        letter-spacing: 0.5px;
        border-radius: 12px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: none;
        color: white;
        position: relative;
        overflow: hidden;
        min-width: 90px;
        box-shadow: 
          0 6px 16px rgba(0, 0, 0, 0.12),
          0 3px 6px rgba(0, 0, 0, 0.08),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
      }

      #selectAllRoles {
        background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
        background-size: 200% 200%;
        animation: gradientShift 3s ease infinite;
      }

      #deselectAllRoles {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
        background-size: 200% 200%;
        animation: gradientShift 3s ease infinite;
      }

      @keyframes gradientShift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
      }

      #selectAllRoles::before, #deselectAllRoles::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      #selectAllRoles:hover::before, #deselectAllRoles:hover::before {
        width: 300px;
        height: 300px;
      }

      #selectAllRoles::after, #deselectAllRoles::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.6s;
      }

      #selectAllRoles:hover::after, #deselectAllRoles:hover::after {
        left: 100%;
      }

      #selectAllRoles:hover, #deselectAllRoles:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 
          0 12px 32px rgba(0, 0, 0, 0.25),
          0 6px 12px rgba(0, 0, 0, 0.15),
          inset 0 1px 0 rgba(255, 255, 255, 0.3);
      }

      #selectAllRoles:active, #deselectAllRoles:active {
        transform: translateY(-1px) scale(0.98);
        box-shadow: 
          0 4px 12px rgba(0, 0, 0, 0.2),
          inset 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      #selectAllRoles span, #deselectAllRoles span {
        position: relative;
        z-index: 1;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .result {
        margin-top: 20px;
        padding: 20px;
        background: linear-gradient(135deg, #f0fff4 0%, #ffffff 100%);
        border-radius: 12px;
        border-left: 5px solid #48bb78;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .solution {
        margin: 15px 0;
        padding: 20px;
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        transition: all 0.3s ease;
      }

      .solution:hover {
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
      }

      .solution-header {
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 12px;
        font-size: 1.1em;
        line-height: 1.4;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .role-match {
        display: flex;
        align-items: center;
        margin: 8px 0;
        padding: 12px;
        background: #f7fafc;
        border-radius: 8px;
        border-left: 3px solid #4299e1;
      }

      .match-score {
        margin-left: 10px;
        font-weight: 600;
        color: #e53e3e;
        font-size: 0.9em;
      }

      .no-solution {
        color: #e53e3e;
        padding: 16px;
        background: #fed7d7;
        border-radius: 8px;
        text-align: center;
        font-size: 1em;
      }

      .total-solution {
        background: #f0fff4;
        border-left: 4px solid #48bb78;
        padding: 20px;
        margin: 20px 0;
        border-radius: 12px;
      }

      .demand-assignment {
        margin: 12px 0;
        padding: 16px;
        background: #ffffff;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
      }

      .result-role-avatar {
        width: 70px;
        height: 70px;
        object-fit: cover;
        border-radius: 10px;
        border: 2px solid rgba(102, 126, 234, 0.2);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        flex-shrink: 0;
      }


      .trait-match {
        font-size: 0.9em;
        color: #718096;
        margin-left: 10px;
      }

      .matched-trait {
        color: #48bb78;
        font-weight: bold;
        background: #c6f6d5;
        padding: 2px 8px;
        border-radius: 4px;
        display: inline-block;
        margin: 2px;
      }

      .unmatched-trait {
        color: #e53e3e;
        background: #fed7d7;
        padding: 2px 8px;
        border-radius: 4px;
        display: inline-block;
        margin: 2px;
      }

      #roles-container {
        display: block;
        margin-top: 20px;
        animation: fadeIn 0.3s ease-in;
      }

      /* è§’è‰²æ ‡ç­¾é¡µæ ·å¼ */
      .role-tabs {
        display: flex;
        gap: 10px;
        margin: 20px 0;
        border-bottom: 2px solid #e2e8f0;
      }

      .role-tab {
        padding: 10px 20px;
        background: transparent;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: 1em;
        font-weight: 600;
        color: #718096;
        transition: all 0.3s ease;
        margin-bottom: -2px;
      }

      .role-tab:hover {
        color: #667eea;
        background: rgba(102, 126, 234, 0.05);
      }

      .role-tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
        background: rgba(102, 126, 234, 0.1);
      }

      .role-job-panel {
        display: none;
        min-height: 50px;
      }

      .role-job-panel.active {
        display: grid !important;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 10px;
        margin-top: 15px;
      }

      /* éœ€æ±‚ç±»åˆ«ç»„æ ·å¼ */
      .demand-category-group {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-bottom: 25px;
        width: 100%;
        box-sizing: border-box;
      }

      /* è§’è‰²å±æ€§ç»„æ ·å¼ */
      .role-attribute-group {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
        width: 100%;
        box-sizing: border-box;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 1200px) {
        .demand-category-group {
          grid-template-columns: repeat(2, 1fr);
        }
        
        .role-attribute-group {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 8px;
          font-size: 14px;
        }

        .container {
          padding: 15px;
          border-radius: 12px;
        }

        h1 {
          font-size: 1.5em;
          margin-bottom: 20px;
        }

        h2 {
          font-size: 1.2em;
          padding-bottom: 8px;
          flex-wrap: wrap;
        }

        .section {
          padding: 12px;
          margin-bottom: 20px;
          border-radius: 10px;
        }

        .checkbox-group {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .demand-category-group {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .role-attribute-group {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .checkbox-item {
          padding: 12px;
          font-size: 0.95em;
          min-height: 44px; /* ç¡®ä¿è§¦æ‘¸ç›®æ ‡è¶³å¤Ÿå¤§ */
        }

        .checkbox-item label {
          font-size: 1.15em;
        }


        .role-info, .demand-info {
          font-size: 0.8em;
          margin-top: 6px;
        }

        .role-avatar {
          width: 50px;
          height: 50px;
          border-radius: 8px;
        }

        button {
          padding: 12px 24px;
          font-size: 1em;
          width: 100%;
          margin: 15px 0;
        }

        #selectAllRoles, #deselectAllRoles {
          padding: 8px 16px;
          font-size: 0.8em;
          flex: 1;
          min-width: 90px;
          margin: 4px;
        }

        .total-solution {
          padding: 15px;
          margin: 15px 0;
        }

        .solution-header {
          font-size: 1.1em;
        }

        .role-match {
          padding: 10px;
          font-size: 0.9em;
        }

        .demand-assignment {
          padding: 12px;
        }

        /* å±æ€§æ ‡é¢˜åœ¨ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .section h2 > div {
          width: 100%;
          margin-top: 10px;
          justify-content: center;
        }

        /* å±æ€§æ ‡é¢˜æ ·å¼ä¼˜åŒ– */
        .section > div[style*="font-size: 1.3em"] {
          font-size: 1.1em !important;
          padding: 10px 0 10px 12px !important;
          margin: 15px 0 10px 0 !important;
        }

        .section > div[style*="font-size: 1.3em"] img {
          width: 20px !important;
          height: 20px !important;
        }

        /* æ ‡ç­¾é¡µåœ¨ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .role-tabs {
          flex-wrap: wrap;
          gap: 5px;
        }

        .role-tab {
          padding: 8px 12px;
          font-size: 0.9em;
          flex: 1;
          min-width: calc(50% - 5px);
          min-height: 44px; /* è§¦æ‘¸ç›®æ ‡å¤§å° */
        }

        /* ç§»åŠ¨ç«¯å›¾ç‰‡ä¼˜åŒ– */
        img {
          max-width: 100%;
          height: auto;
        }

        /* ç§»åŠ¨ç«¯æ»šåŠ¨ä¼˜åŒ– */
        .container {
          overflow-x: hidden;
        }

        /* ç§»åŠ¨ç«¯æ–‡å­—æ¢è¡Œä¼˜åŒ– */
        .role-info, .demand-info {
          word-break: break-word;
          overflow-wrap: break-word;
        }

        /* ç§»åŠ¨ç«¯ç‰¹æ€§æ ‡ç­¾ä¼˜åŒ– */
        .trait-badge {
          display: inline-block;
          white-space: nowrap;
        }

        /* éœ€æ±‚é€‰æ‹©åœ¨ç§»åŠ¨ç«¯ä¼˜åŒ– */
        .demand-info {
          width: 100%;
          max-width: 100%;
        }

        .demand-info > div {
          width: 100% !important;
          max-width: 100% !important;
          overflow: visible !important;
        }

        /* ç¡®ä¿éœ€æ±‚å¡ç‰‡å†…å®¹ä¸æº¢å‡º */
        .checkbox-item {
          min-width: 0;
          overflow: visible;
          width: 100%;
          max-width: 100%;
        }

        .checkbox-item > div {
          min-width: 0;
          overflow: visible;
          width: 100%;
          max-width: 100%;
        }

        /* éœ€æ±‚ç±»åˆ«ç»„åœ¨ç§»åŠ¨ç«¯ç¡®ä¿å•åˆ— */
        .demand-category-group {
          grid-template-columns: 1fr !important;
          width: 100% !important;
          max-width: 100% !important;
        }
      }

      /* æ›´å°çš„ç§»åŠ¨è®¾å¤‡ */
      @media (max-width: 480px) {
        body {
          padding: 5px;
          font-size: 13px;
        }

        .container {
          padding: 10px;
        }

        h1 {
          font-size: 1.3em;
          margin-bottom: 15px;
        }

        h2 {
          font-size: 1.1em;
        }

        .section {
          padding: 10px;
        }

        .checkbox-item {
          padding: 10px;
        }

        .trait-badge {
          font-size: 0.75em;
          padding: 3px 6px;
        }

        .role-tab {
          padding: 6px 8px;
          font-size: 0.85em;
          min-width: calc(33.333% - 4px);
          min-height: 40px;
        }

        .section > div[style*="font-size: 1.3em"] {
          font-size: 1em !important;
          padding: 8px 0 8px 10px !important;
        }

        .section > div[style*="font-size: 1.3em"] img {
          width: 18px !important;
          height: 18px !important;
        }
      }

      /* æ¨ªå±æ¨¡å¼ä¼˜åŒ– */
      @media (max-width: 768px) and (orientation: landscape) {
        .container {
          padding: 12px;
        }

        h1 {
          font-size: 1.4em;
          margin-bottom: 15px;
        }

        .section {
          padding: 10px;
        }
      }

      /* åŠ è½½åŠ¨ç”» */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      /* æ ‡ç­¾æ ·å¼ä¼˜åŒ– */
      .trait-badge {
        display: inline-block;
        padding: 4px 10px;
        margin: 2px 4px;
        border-radius: 12px;
        font-size: 0.85em;
        font-weight: 500;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .trait-badge.matched {
        background: #c6f6d5;
        color: #22543d;
      }

      .trait-badge.unmatched {
        background: #fed7d7;
        color: #742a2a;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateX(-50%) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
      }

      @keyframes slideUp {
        from {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
        to {
          opacity: 0;
          transform: translateX(-50%) translateY(-20px);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      

      <!-- è§’è‰²é€‰æ‹©åŒºåŸŸ -->
      <div class="section">
        <h2>
          <span style="display: inline-flex; align-items: center;">
            <img src="" alt="å¯ç”¨è§’è‰²" class="role-icon">
            <span class="role-title-text">å¯ç”¨è§’è‰²</span>
          </span>
          <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
            <button id="selectAllRoles">
              <span>å…¨é€‰</span>
            </button>
            <button id="deselectAllRoles">
              <span>å…¨ä¸é€‰</span>
            </button>
          </div>
        </h2>
        <!-- è§’è‰²å®¹å™¨ -->
        <div id="roles-container"></div>
      </div>

      <!-- éœ€æ±‚é€‰æ‹©åŒºåŸŸ -->
      <div class="section">
        <h2>ğŸ“‹ éœ€æ±‚é€‰æ‹©</h2>
        <div id="demands-container"></div>
      </div>

      <!-- åŒ¹é…æŒ‰é’® -->
      <button onclick="matchDemands()">å¼€å§‹åŒ¹é…</button>

      <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
      <div class="section">
        <h2>âœ¨ åŒ¹é…ç»“æœ</h2>
        <div id="results-container"></div>
      </div>
    </div>

    <script>
      // è§’è‰²æ•°æ® - ä¼˜åŒ–æ•°æ®ç»“æ„
      const roles = [
        // æ°´å±æ€§
        { åç§°: "åƒéƒ½å¸‚", å±æ€§: "æ°´", æ˜Ÿçº§: "äº”æ˜Ÿ", èŒä¸š: "å…ˆé”‹", ç‰¹æ€§: ["æ±‚çŸ¥å¿ƒåˆ‡"] },
        { åç§°: "è‹å…°", å±æ€§: "æ°´", æ˜Ÿçº§: "äº”æ˜Ÿ", èŒä¸š: "å‡è¡¡", ç‰¹æ€§: ["å†’é™©å®¶"] },
        { åç§°: "å¸ˆæ¸º", å±æ€§: "æ°´", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å…ˆé”‹", ç‰¹æ€§: ["æ±‚çŸ¥å¿ƒåˆ‡"] },
        { åç§°: "é¸¢å°¾", å±æ€§: "æ°´", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å‡è¡¡", ç‰¹æ€§: ["å¥‡æ€å¦™æƒ³"] },
        { åç§°: "ç‰¹ä¸½è", å±æ€§: "æ°´", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "è¾…åŠ©", ç‰¹æ€§: ["ç¨³æ‰ç¨³æ‰“"] },
        // ç«å±æ€§
        { åç§°: "èµ¤éœ", å±æ€§: "ç«", æ˜Ÿçº§: "äº”æ˜Ÿ", èŒä¸š: "å‡è¡¡", ç‰¹æ€§: ["æ”¶é›†æ§"] },
        { åç§°: "ç¥ç€", å±æ€§: "ç«", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å…ˆé”‹", ç‰¹æ€§: ["æ”¶é›†æ§"] },
        { åç§°: "å¡è¥¿ç±³æ‹‰", å±æ€§: "ç«", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å‡è¡¡", ç‰¹æ€§: ["å†’é™©å®¶"] },
        { åç§°: "ç´«æ§¿", å±æ€§: "ç«", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "è¾…åŠ©", ç‰¹æ€§: ["æ”¶é›†æ§"] },
        // åœ°å±æ€§
        { åç§°: "æ ¼è‹ª", å±æ€§: "åœ°", æ˜Ÿçº§: "äº”æ˜Ÿ", èŒä¸š: "å…ˆé”‹", ç‰¹æ€§: ["æ±‚çŸ¥å¿ƒåˆ‡"] },
        { åç§°: "å°ç¦¾", å±æ€§: "åœ°", æ˜Ÿçº§: "äº”æ˜Ÿ", èŒä¸š: "è¾…åŠ©", ç‰¹æ€§: ["æ”¶é›†æ§"] },
        { åç§°: "å²­å·", å±æ€§: "åœ°", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å‡è¡¡", ç‰¹æ€§: ["æ”¶é›†æ§"] },
        // é£å±æ€§
        { åç§°: "èŠ±åŸ", å±æ€§: "é£", æ˜Ÿçº§: "äº”æ˜Ÿ", èŒä¸š: "å…ˆé”‹", ç‰¹æ€§: ["æ±‚çŸ¥å¿ƒåˆ‡"] },
        { åç§°: "å°˜æ²™", å±æ€§: "é£", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å…ˆé”‹", ç‰¹æ€§: ["å¥‡æ€å¦™æƒ³"] },
        { åç§°: "å¡å¨œä¸", å±æ€§: "é£", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å‡è¡¡", ç‰¹æ€§: ["å†’é™©å®¶"] },
        { åç§°: "æå­", å±æ€§: "é£", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "è¾…åŠ©", ç‰¹æ€§: ["å†’é™©å®¶"] },
        // å…‰å±æ€§
        { åç§°: "å¸Œå¨…", å±æ€§: "å…‰", æ˜Ÿçº§: "äº”æ˜Ÿ", èŒä¸š: "å…ˆé”‹", ç‰¹æ€§: ["å†’é™©å®¶"] },
        { åç§°: "å¯†æ¶…ç“¦", å±æ€§: "å…‰", æ˜Ÿçº§: "äº”æ˜Ÿ", èŒä¸š: "å‡è¡¡", ç‰¹æ€§: ["ç¨³æ‰ç¨³æ‰“"] },
        { åç§°: "èˆéœ²", å±æ€§: "å…‰", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å…ˆé”‹", ç‰¹æ€§: ["å†’é™©å®¶"] },
        { åç§°: "ç’ŸéºŸ", å±æ€§: "å…‰", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å‡è¡¡", ç‰¹æ€§: ["æ±‚çŸ¥å¿ƒåˆ‡"] },
        { åç§°: "ç¼‡è‰å¨…", å±æ€§: "å…‰", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "è¾…åŠ©", ç‰¹æ€§: ["ç¨³æ‰ç¨³æ‰“"] },
        // æš—å±æ€§
        { åç§°: "é›¾è¯­", å±æ€§: "æš—", æ˜Ÿçº§: "äº”æ˜Ÿ", èŒä¸š: "å‡è¡¡", ç‰¹æ€§: ["å¥‡æ€å¦™æƒ³"] },
        { åç§°: "ç„¦ç³–", å±æ€§: "æš—", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å…ˆé”‹", ç‰¹æ€§: ["å¥‡æ€å¦™æƒ³"] },
        { åç§°: "ç§‘æ´›å°¼ä¸", å±æ€§: "æš—", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "å‡è¡¡", ç‰¹æ€§: ["å†’é™©å®¶"] },
        { åç§°: "ç‚èµ›ç‰¹", å±æ€§: "æš—", æ˜Ÿçº§: "å››æ˜Ÿ", èŒä¸š: "è¾…åŠ©", ç‰¹æ€§: ["æ±‚çŸ¥å¿ƒåˆ‡"] },
      ];

      // éœ€æ±‚æ•°æ® - ä¼˜åŒ–æ•°æ®ç»“æ„ï¼ŒæŒ‰ç±»åˆ«åˆ†ç»„
      const demands = [
        // ç¤¾åŒºå¸®æ‰‹
        {
          ç‰©å“åç§°: "æœµæ‹‰",
          ç±»åˆ«: "ç¤¾åŒºå¸®æ‰‹",
          èŒä¸šéœ€æ±‚: ["å…ˆé”‹", "å…ˆé”‹", "å‡è¡¡"],
          ç‰¹æ€§éœ€æ±‚: ["å†’é™©å®¶", "æ±‚çŸ¥å¿ƒåˆ‡"],
        },
        {
          ç‰©å“åç§°: "æ—…äººç»éªŒ",
          ç±»åˆ«: "ç¤¾åŒºå¸®æ‰‹",
          èŒä¸šéœ€æ±‚: ["å…ˆé”‹", "å…ˆé”‹", "å‡è¡¡"],
          ç‰¹æ€§éœ€æ±‚: ["å†’é™©å®¶", "å¥‡æ€å¦™æƒ³"],
        },
        {
          ç‰©å“åç§°: "ç§˜çº¹ç»éªŒ",
          ç±»åˆ«: "ç¤¾åŒºå¸®æ‰‹",
          èŒä¸šéœ€æ±‚: ["å‡è¡¡", "å‡è¡¡", "è¾…åŠ©"],
          ç‰¹æ€§éœ€æ±‚: ["æ”¶é›†æ§", "å†’é™©å®¶"],
        },
        // è¿·å¢ƒæ¢ç´¢
        {
          ç‰©å“åç§°: "å¸½å­",
          ç±»åˆ«: "è¿·å¢ƒæ¢ç´¢",
          èŒä¸šéœ€æ±‚: ["å…ˆé”‹", "å…ˆé”‹", "è¾…åŠ©"],
          ç‰¹æ€§éœ€æ±‚: ["ç¨³æ‰ç¨³æ‰“", "æ±‚çŸ¥å¿ƒåˆ‡"],
        },
        {
          ç‰©å“åç§°: "ç½å­",
          ç±»åˆ«: "è¿·å¢ƒæ¢ç´¢",
          èŒä¸šéœ€æ±‚: ["å…ˆé”‹", "å…ˆé”‹", "è¾…åŠ©"],
          ç‰¹æ€§éœ€æ±‚: ["æ”¶é›†æ§", "å¥‡æ€å¦™æƒ³"],
        },
        {
          ç‰©å“åç§°: "ç¯æ³¡",
          ç±»åˆ«: "è¿·å¢ƒæ¢ç´¢",
          èŒä¸šéœ€æ±‚: ["å‡è¡¡", "å‡è¡¡", "è¾…åŠ©"],
          ç‰¹æ€§éœ€æ±‚: ["ç¨³æ‰ç¨³æ‰“", "å¥‡æ€å¦™æƒ³"],
        },
        // æ˜Ÿéª¸è¿½è¸ª
        {
          ç‰©å“åç§°: "æ€ªè¯æ®‹æ¯",
          ç±»åˆ«: "æ˜Ÿéª¸è¿½è¸ª",
          èŒä¸šéœ€æ±‚: ["è¾…åŠ©", "å‡è¡¡", "å‡è¡¡"],
          ç‰¹æ€§éœ€æ±‚: ["å†’é™©å®¶", "ç¨³æ‰ç¨³æ‰“"],
        },
        {
          ç‰©å“åç§°: "å˜Ÿå™œæ®‹æ¯",
          ç±»åˆ«: "æ˜Ÿéª¸è¿½è¸ª",
          èŒä¸šéœ€æ±‚: ["å…ˆé”‹", "è¾…åŠ©", "å…ˆé”‹"],
          ç‰¹æ€§éœ€æ±‚: ["æ”¶é›†æ§", "æ±‚çŸ¥å¿ƒåˆ‡"],
        },
        {
          ç‰©å“åç§°: "å¾®å…‰æ®‹æ¯",
          ç±»åˆ«: "æ˜Ÿéª¸è¿½è¸ª",
          èŒä¸šéœ€æ±‚: ["å…ˆé”‹", "å‡è¡¡", "å‡è¡¡"],
          ç‰¹æ€§éœ€æ±‚: ["å¥‡æ€å¦™æƒ³", "æ±‚çŸ¥å¿ƒåˆ‡"],
        },
        // å¡å¸¦å›æ”¶
        {
          ç‰©å“åç§°: "èŠ‚å¥å¡å¸¦",
          ç±»åˆ«: "å¡å¸¦å›æ”¶",
          èŒä¸šéœ€æ±‚: ["å…ˆé”‹", "å…ˆé”‹", "å‡è¡¡"],
          ç‰¹æ€§éœ€æ±‚: ["æ”¶é›†æ§", "æ±‚çŸ¥å¿ƒåˆ‡"],
        },
        {
          ç‰©å“åç§°: "å°„å‡»å¡å¸¦",
          ç±»åˆ«: "å¡å¸¦å›æ”¶",
          èŒä¸šéœ€æ±‚: ["å…ˆé”‹", "å‡è¡¡", "å‡è¡¡"],
          ç‰¹æ€§éœ€æ±‚: ["ç¨³æ‰ç¨³æ‰“", "å¥‡æ€å¦™æƒ³"],
        },
        {
          ç‰©å“åç§°: "åŠŸå¤«å¡å¸¦",
          ç±»åˆ«: "å¡å¸¦å›æ”¶",
          èŒä¸šéœ€æ±‚: ["å‡è¡¡", "è¾…åŠ©", "è¾…åŠ©"],
          ç‰¹æ€§éœ€æ±‚: ["ç¨³æ‰ç¨³æ‰“", "æ±‚çŸ¥å¿ƒåˆ‡"],
        },
      ];

      // æœ¬åœ°å­˜å‚¨ç›¸å…³å‡½æ•°
      function saveSelectedRoles() {
        const selectedRoles = [];
        document.querySelectorAll('.checkbox-item[data-role-index]').forEach(item => {
          const roleIndex = parseInt(item.getAttribute('data-role-index'));
          if (item.classList.contains('selected')) {
            selectedRoles.push(roleIndex);
          }
        });
        localStorage.setItem('selectedRoles', JSON.stringify(selectedRoles));
      }

      function loadSelectedRoles() {
        const saved = localStorage.getItem('selectedRoles');
        if (saved) {
          try {
            const selectedIndices = JSON.parse(saved);
            const selectedSet = new Set(selectedIndices);
            document.querySelectorAll('.checkbox-item[data-role-index]').forEach(item => {
              const roleIndex = parseInt(item.getAttribute('data-role-index'));
              if (selectedSet.has(roleIndex)) {
                item.classList.add('selected');
              } else {
                item.classList.remove('selected');
              }
            });
            return true;
          } catch (e) {
            console.error('åŠ è½½ä¿å­˜çš„è§’è‰²é€‰æ‹©å¤±è´¥:', e);
          }
        }
        return false;
      }

      // ä¿å­˜éœ€æ±‚é€‰æ‹©
      function saveSelectedDemands() {
        const selectedDemands = [];
        document.querySelectorAll('.checkbox-item[data-demand-index]').forEach(item => {
          const demandIndex = parseInt(item.getAttribute('data-demand-index'));
          if (item.classList.contains('selected')) {
            selectedDemands.push(demandIndex);
          }
        });
        localStorage.setItem('selectedDemands', JSON.stringify(selectedDemands));
      }

      // åŠ è½½éœ€æ±‚é€‰æ‹©
      function loadSelectedDemands() {
        const saved = localStorage.getItem('selectedDemands');
        if (saved) {
          try {
            const selectedIndices = JSON.parse(saved);
            const selectedSet = new Set(selectedIndices);
            document.querySelectorAll('.checkbox-item[data-demand-index]').forEach(item => {
              const demandIndex = parseInt(item.getAttribute('data-demand-index'));
              if (selectedSet.has(demandIndex)) {
                item.classList.add('selected');
              } else {
                item.classList.remove('selected');
              }
            });
            return true;
          } catch (e) {
            console.error('åŠ è½½ä¿å­˜çš„éœ€æ±‚é€‰æ‹©å¤±è´¥:', e);
          }
        }
        return false;
      }

      // å¤„ç†å¤´åƒåŠ è½½é”™è¯¯
      function handleAvatarError(img) {
        const roleName = img.getAttribute('data-role-name');
        if (!roleName) {
          img.style.display = 'none';
          return;
        }
        
        const possibleNames = [
          `img/${roleName}.jpg`,
          `img/${roleName}.jpeg`,
          `img/${roleName}_avatar.png`,
          `img/${roleName}_å¤´åƒ.png`,
          `img/${roleName}_å¤´åƒ.jpg`
        ];
        
        let index = 0;
        const tryNext = () => {
          if (index < possibleNames.length) {
            const testImg = new Image();
            testImg.onload = () => {
              img.src = possibleNames[index];
              img.style.display = '';
            };
            testImg.onerror = () => {
              index++;
              tryNext();
            };
            testImg.src = possibleNames[index];
          } else {
            img.style.display = 'none';
          }
        };
        tryNext();
      }

      // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
      function showMessage(message, type = 'info') {
        // ç§»é™¤å·²å­˜åœ¨çš„æ¶ˆæ¯
        const existingMessage = document.getElementById('message-toast');
        if (existingMessage) {
          existingMessage.remove();
        }
        
        // åˆ›å»ºæ¶ˆæ¯å…ƒç´ 
        const messageDiv = document.createElement('div');
        messageDiv.id = 'message-toast';
        messageDiv.textContent = message;
        
        // æ ¹æ®ç±»å‹è®¾ç½®æ ·å¼
        const colors = {
          'info': { bg: '#4299e1', text: '#ffffff' },
          'warning': { bg: '#fbbf24', text: '#ffffff' },
          'error': { bg: '#f56565', text: '#ffffff' },
          'success': { bg: '#48bb78', text: '#ffffff' }
        };
        
        const color = colors[type] || colors['info'];
        messageDiv.style.cssText = `
          position: fixed;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: ${color.bg};
          color: ${color.text};
          padding: 12px 24px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          z-index: 10000;
          font-size: 14px;
          font-weight: 600;
          animation: slideDown 0.3s ease-out;
        `;
        
        // æ·»åŠ åˆ°é¡µé¢
        document.body.appendChild(messageDiv);
        
        // 3ç§’åè‡ªåŠ¨ç§»é™¤
        setTimeout(() => {
          messageDiv.style.animation = 'slideUp 0.3s ease-out';
          setTimeout(() => {
            if (messageDiv.parentNode) {
              messageDiv.remove();
            }
          }, 300);
        }, 3000);
      }

      // åˆå§‹åŒ–é¡µé¢
      function initializePage() {
        console.log("å¼€å§‹åˆå§‹åŒ–é¡µé¢...");
        console.log("è§’è‰²æ•°é‡:", roles.length);
        
        // åˆå§‹åŒ–è§’è‰²é€‰æ‹© - æŒ‰å±æ€§åˆ†ç»„æ˜¾ç¤ºï¼ˆç±»ä¼¼éœ€æ±‚é€‰æ‹©ï¼‰
        const rolesContainer = document.getElementById("roles-container");
        if (!rolesContainer) {
          console.error("æ‰¾ä¸åˆ° roles-container å…ƒç´ ");
          return;
        }
        console.log("æ‰¾åˆ° roles-container å…ƒç´ ");
        
        // æ¸…ç©ºå®¹å™¨
        rolesContainer.innerHTML = "";
        
        const attributes = ["æ°´", "ç«", "åœ°", "é£", "å…‰", "æš—"];
        
        // å±æ€§é¢œè‰²æ˜ å°„
        const attributeColors = {
          "æ°´": "#4299e1",
          "ç«": "#f56565",
          "åœ°": "#48bb78",
          "é£": "#38b2ac",
          "å…‰": "#fbbf24",
          "æš—": "#805ad5"
        };
        
        // å±æ€§å›¾æ ‡æ˜ å°„ï¼ˆä½¿ç”¨emojiä½œä¸ºå¤‡ç”¨ï¼‰
        const attributeIcons = {
          "æ°´": "ğŸ’§",
          "ç«": "ğŸ”¥",
          "åœ°": "ğŸŒ",
          "é£": "ğŸ’¨",
          "å…‰": "âœ¨",
          "æš—": "ğŸŒ‘"
        };
        
        // å±æ€§å›¾ç‰‡URLæ˜ å°„ï¼ˆä½¿ç”¨imgæ–‡ä»¶å¤¹ï¼‰
        const attributeImages = {
          "æ°´": "img/æ°´.png",
          "ç«": "img/ç«.png",
          "åœ°": "img/åœ°.png",
          "é£": "img/é£.png",
          "å…‰": "img/å…‰.png",
          "æš—": "img/æš—.png"
        };
        
        // æ˜Ÿçº§å›¾ç‰‡URLæ˜ å°„ï¼ˆä½¿ç”¨imgæ–‡ä»¶å¤¹ï¼‰
        const starImages = {
          "å››æ˜Ÿ": "img/å››æ˜Ÿ.png",
          "äº”æ˜Ÿ": "img/äº”æ˜Ÿ.png"
        };
        
        // æŒ‰å±æ€§åˆ†ç»„æ˜¾ç¤º
        attributes.forEach((attribute, attrIndex) => {
          // åˆ›å»ºå±æ€§æ ‡é¢˜
          const attributeTitle = document.createElement("div");
          const attrColor = attributeColors[attribute] || "#667eea";
          // å°†åå…­è¿›åˆ¶é¢œè‰²è½¬æ¢ä¸ºrgba
          const r = parseInt(attrColor.slice(1, 3), 16);
          const g = parseInt(attrColor.slice(3, 5), 16);
          const b = parseInt(attrColor.slice(5, 7), 16);
          attributeTitle.style.cssText = `font-size: 1.4em; font-weight: 700; color: ${attrColor}; margin: 28px 0 18px 0; padding: 14px 0 14px 18px; border-left: 6px solid ${attrColor}; background: linear-gradient(135deg, rgba(${r}, ${g}, ${b}, 0.12) 0%, rgba(${r}, ${g}, ${b}, 0.05) 50%, rgba(255, 255, 255, 0) 100%); border-radius: 12px; display: flex; align-items: center; gap: 12px; box-shadow: 0 2px 8px rgba(${r}, ${g}, ${b}, 0.1);`;
          const attrImg = attributeImages[attribute] || '';
          if (attrImg) {
            attributeTitle.innerHTML = `<span style="display: inline-flex; align-items: center; vertical-align: middle;">
              <img src="${attrImg}" alt="${attribute}" style="width: 24px; height: 24px; object-fit: contain; vertical-align: middle;">
            </span>
            <span>${attribute}</span>`;
          } else {
            attributeTitle.textContent = `${attributeIcons[attribute]} ${attribute}`;
          }
          rolesContainer.appendChild(attributeTitle);
          
          // åˆ›å»ºè¯¥å±æ€§çš„è§’è‰²å®¹å™¨
          const attributeContainer = document.createElement("div");
          attributeContainer.style.cssText = "display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; width: 100%; box-sizing: border-box;";
          attributeContainer.className = "role-attribute-group";
          
          // è·å–è¯¥å±æ€§çš„æ‰€æœ‰è§’è‰²
          const attrRoles = roles.filter(r => r.å±æ€§ === attribute);
          console.log(`${attribute} å±æ€§è§’è‰²æ•°é‡:`, attrRoles.length);
          
          attrRoles.forEach((role, roleIndex) => {
            const globalIndex = roles.indexOf(role);
            const checkboxItem = document.createElement("div");
            checkboxItem.className = "checkbox-item";
            const traits = role.ç‰¹æ€§.map(t => `<span class="trait-badge" style="background: #e2e8f0; color: #4a5568;">${t}</span>`).join(' ');
            const attrImg = attributeImages[role.å±æ€§] || '';
            const starImg = starImages[role.æ˜Ÿçº§] || '';
            // å°è¯•å¤šç§å¯èƒ½çš„å¤´åƒæ–‡ä»¶åæ ¼å¼
            const roleAvatarNames = [
              `img/${role.åç§°}.png`,
              `img/${role.åç§°}.jpg`,
              `img/${role.åç§°}.jpeg`,
              `img/${role.åç§°}_avatar.png`,
              `img/${role.åç§°}_å¤´åƒ.png`
            ];
            const roleAvatar = roleAvatarNames[0]; // é»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä¸ª
            checkboxItem.setAttribute('data-role-index', globalIndex);
            checkboxItem.innerHTML = `
                      <div class="role-check-indicator"></div>
                      <div style="flex: 1;">
                        <label>${role.åç§°}</label>
                        <span class="role-info">
                          <div style="display: flex; align-items: flex-start; gap: 10px; margin-top: 4px;">
                            <img src="${roleAvatar}" alt="${role.åç§°}" class="role-avatar" data-role-name="${role.åç§°}" onerror="handleAvatarError(this);">
                            <div style="flex: 1; display: flex; flex-direction: column; gap: 4px; min-width: 0;">
                              <div style="display: flex; align-items: center; gap: 8px; flex-wrap: nowrap; white-space: nowrap; overflow-x: auto;">
                                ${attrImg ? `<span style="display: inline-flex; align-items: center; vertical-align: middle; flex-shrink: 0;">
                                  <img src="${attrImg}" alt="${role.å±æ€§}" style="width: 20px; height: 20px; object-fit: contain; vertical-align: middle;">
                                </span>` : `<span style="color: ${attrColor}; font-weight: 600; flex-shrink: 0;">${role.å±æ€§}</span>`}
                                ${starImg ? `<span style="display: inline-flex; align-items: center; vertical-align: middle; flex-shrink: 0;">
                                  <img src="${starImg}" alt="${role.æ˜Ÿçº§}" style="height: 16px; object-fit: contain; vertical-align: middle;">
                                </span>` : `<span style="color: #fbbf24; font-weight: 600; flex-shrink: 0;">${role.æ˜Ÿçº§}</span>`}
                                <span style="color: #667eea; font-weight: 600; flex-shrink: 0;">${role.èŒä¸š}</span>
                              </div>
                              <div style="white-space: nowrap; overflow-x: auto; display: flex; align-items: center; gap: 4px;">ç‰¹æ€§: ${traits}</div>
                            </div>
                          </div>
                        </span>
                      </div>
                  `;
            // ç‚¹å‡»åˆ‡æ¢é€‰ä¸­çŠ¶æ€
            checkboxItem.addEventListener('click', function(e) {
              const roleIndex = parseInt(this.getAttribute('data-role-index'));
              this.classList.toggle('selected');
              saveSelectedRoles(); // ä¿å­˜é€‰æ‹©
            });
            attributeContainer.appendChild(checkboxItem);
          });
          
          // å³ä½¿æ²¡æœ‰è§’è‰²ä¹Ÿæ·»åŠ å®¹å™¨ï¼ˆæ˜¾ç¤ºæ ‡é¢˜ï¼‰
          rolesContainer.appendChild(attributeContainer);
          console.log(`å·²æ·»åŠ  ${attribute} å±æ€§å®¹å™¨ï¼ŒåŒ…å« ${attrRoles.length} ä¸ªè§’è‰²`);
        });
        
        console.log("è§’è‰²åˆå§‹åŒ–å®Œæˆï¼Œå®¹å™¨å­å…ƒç´ æ•°é‡:", rolesContainer.children.length);

        // åŠ è½½ä¿å­˜çš„è§’è‰²é€‰æ‹©ï¼Œå¦‚æœæ²¡æœ‰ä¿å­˜åˆ™é»˜è®¤å…¨é€‰
        const hasSaved = loadSelectedRoles();
        if (!hasSaved) {
          // é»˜è®¤å…¨é€‰
          document.querySelectorAll('.checkbox-item[data-role-index]').forEach(item => {
            item.classList.add('selected');
          });
          saveSelectedRoles();
        }

        // å…¨é€‰/å…¨ä¸é€‰åŠŸèƒ½
        document.getElementById('selectAllRoles').addEventListener('click', function() {
          document.querySelectorAll('.checkbox-item[data-role-index]').forEach(item => {
            item.classList.add('selected');
          });
          saveSelectedRoles();
        });

        document.getElementById('deselectAllRoles').addEventListener('click', function() {
          document.querySelectorAll('.checkbox-item[data-role-index]').forEach(item => {
            item.classList.remove('selected');
          });
          saveSelectedRoles();
        });

        // åˆå§‹åŒ–éœ€æ±‚é€‰æ‹© - æŒ‰ç±»åˆ«åˆ†ç»„æ˜¾ç¤º
        const demandsContainer = document.getElementById("demands-container");
        const categories = ["ç¤¾åŒºå¸®æ‰‹", "è¿·å¢ƒæ¢ç´¢", "æ˜Ÿéª¸è¿½è¸ª", "å¡å¸¦å›æ”¶"];
        
        categories.forEach((category, categoryIndex) => {
          // åˆ›å»ºç±»åˆ«æ ‡é¢˜
          const categoryTitle = document.createElement("div");
          categoryTitle.style.cssText = "font-size: 1.4em; font-weight: 700; color: #667eea; margin: 28px 0 18px 0; padding: 14px 0 14px 18px; border-left: 6px solid #667eea; background: linear-gradient(135deg, rgba(102, 126, 234, 0.12) 0%, rgba(102, 126, 234, 0.05) 50%, rgba(255, 255, 255, 0) 100%); border-radius: 12px; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);";
          categoryTitle.textContent = `${category}`;
          demandsContainer.appendChild(categoryTitle);
          
          // åˆ›å»ºè¯¥ç±»åˆ«çš„éœ€æ±‚å®¹å™¨
          const categoryContainer = document.createElement("div");
          categoryContainer.className = "demand-category-group";
          // ä½¿ç”¨ç±»åæ§åˆ¶æ ·å¼ï¼Œé¿å…å†…è”æ ·å¼è¦†ç›–å“åº”å¼è®¾è®¡
          // åŸºç¡€æ ·å¼é€šè¿‡CSSç±»æ§åˆ¶ï¼Œå“åº”å¼é€šè¿‡åª’ä½“æŸ¥è¯¢æ§åˆ¶
          
          // è·å–è¯¥ç±»åˆ«çš„éœ€æ±‚
          const categoryDemands = demands.filter(d => d.ç±»åˆ« === category);
          
          categoryDemands.forEach((demand, itemIndex) => {
            const globalIndex = demands.indexOf(demand);
            const checkboxItem = document.createElement("div");
            checkboxItem.className = "checkbox-item";
            checkboxItem.setAttribute('data-demand-index', globalIndex);
            const jobTags = demand.èŒä¸šéœ€æ±‚.map(j => `<span class="trait-badge" style="background: #cbd5e0; color: #2d3748;">${j}</span>`).join(' ');
            const traitTags = demand.ç‰¹æ€§éœ€æ±‚.map(t => `<span class="trait-badge" style="background: #cbd5e0; color: #2d3748;">${t}</span>`).join(' ');
            checkboxItem.innerHTML = `
                      <div class="role-check-indicator"></div>
                      <div style="flex: 1;">
                        <label>${demand.ç‰©å“åç§°}</label>
                        <span class="demand-info">
                          <div style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 4px; align-items: center;">
                            <span style="color: #4a5568; font-weight: 600; flex-shrink: 0;">èŒä¸šéœ€æ±‚:</span> ${jobTags}
                          </div>
                          <div style="margin-top: 6px; display: flex; flex-wrap: nowrap; gap: 4px; align-items: center; overflow-x: auto;">
                            <span style="color: #4a5568; font-weight: 600; flex-shrink: 0;">ç‰¹æ€§éœ€æ±‚:</span> ${traitTags}
                          </div>
                        </span>
                      </div>
                  `;
            // ç‚¹å‡»åˆ‡æ¢é€‰ä¸­çŠ¶æ€
            checkboxItem.addEventListener('click', function(e) {
              const demandIndex = parseInt(this.getAttribute('data-demand-index'));
              const isCurrentlySelected = this.classList.contains('selected');
              
              // å¦‚æœè¦é€‰ä¸­æ–°é¡¹ï¼Œæ£€æŸ¥æ˜¯å¦å·²è¾¾åˆ°æœ€å¤§é€‰æ‹©æ•°é‡
              if (!isCurrentlySelected) {
                // è®¡ç®—å½“å‰å·²é€‰æ‹©çš„éœ€æ±‚æ•°é‡
                const selectedCount = document.querySelectorAll('.checkbox-item[data-demand-index].selected').length;
                if (selectedCount >= 4) {
                  // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                  showMessage('æœ€å¤šåªèƒ½é€‰æ‹©4ä¸ªéœ€æ±‚', 'warning');
                  return; // é˜»æ­¢é€‰æ‹©
                }
              }
              
              this.classList.toggle('selected');
              saveSelectedDemands(); // ä¿å­˜éœ€æ±‚é€‰æ‹©
            });
            categoryContainer.appendChild(checkboxItem);
          });
          
          demandsContainer.appendChild(categoryContainer);
        });
        
        // åŠ è½½ä¿å­˜çš„éœ€æ±‚é€‰æ‹©
        loadSelectedDemands();
      }

      // è·å–é€‰ä¸­çš„è§’è‰²
      function getSelectedRoles() {
        const selectedRoles = [];
        document.querySelectorAll('.checkbox-item[data-role-index]').forEach(item => {
          const roleIndex = parseInt(item.getAttribute('data-role-index'));
          if (item.classList.contains('selected')) {
            selectedRoles.push({ ...roles[roleIndex], index: roleIndex });
          }
        });
        return selectedRoles;
      }

      // è·å–é€‰ä¸­çš„éœ€æ±‚
      function getSelectedDemands() {
        const selectedDemands = [];
        document.querySelectorAll('.checkbox-item[data-demand-index]').forEach(item => {
          const demandIndex = parseInt(item.getAttribute('data-demand-index'));
          if (item.classList.contains('selected')) {
            selectedDemands.push({ ...demands[demandIndex], index: demandIndex });
          }
        });
        return selectedDemands;
      }

      // è·å–è§’è‰²åŒ¹é…çš„ç‰¹æ€§åˆ—è¡¨
      function getMatchedTraits(roleTraits, demandTraits) {
        const matched = [];
        const unmatched = [...demandTraits];

        roleTraits.forEach((trait) => {
          const index = unmatched.indexOf(trait);
          if (index !== -1) {
            matched.push(trait);
            unmatched.splice(index, 1);
          }
        });

        return { matched, unmatched };
      }
      // æ£€æŸ¥è§’è‰²æ˜¯å¦æ»¡è¶³èŒä¸šéœ€æ±‚
      function roleSatisfiesJob(role, job) {
        return role.èŒä¸š === job;
      }

      // è®¡ç®—è§’è‰²å¯¹éœ€æ±‚çš„ç‰¹æ€§åŒ¹é…åˆ†æ•°
      function calculateTraitScore(role, demand) {
        const { matched } = getMatchedTraits(role.ç‰¹æ€§, demand.ç‰¹æ€§éœ€æ±‚);
        return matched.length;
      }

      // æ£€æŸ¥ä¸€ä¸ªéœ€æ±‚çš„æ‰€æœ‰è§’è‰²æ˜¯å¦æ»¡è¶³ç‰¹æ€§éœ€æ±‚ï¼ˆæ•´ä½“è€ƒè™‘ï¼‰
      function checkDemandTraitsSatisfied(assignedRoles, demandTraits) {
        const satisfiedTraits = new Set();

        for (const role of assignedRoles) {
          const { matched } = getMatchedTraits(role.ç‰¹æ€§, demandTraits);
          matched.forEach((trait) => satisfiedTraits.add(trait));

          // å¦‚æœæ‰€æœ‰ç‰¹æ€§éƒ½å·²æ»¡è¶³ï¼Œæå‰è¿”å›
          if (satisfiedTraits.size === demandTraits.length) {
            return true;
          }
        }

        return satisfiedTraits.size === demandTraits.length;
      }

      // è®¡ç®—ä¸€ä¸ªéœ€æ±‚çš„ç‰¹æ€§åŒ¹é…æƒ…å†µ
      function calculateDemandTraitScore(assignedRoles, demandTraits) {
        const satisfiedTraits = new Set();

        // æ·»åŠ æ•°ç»„æ£€æŸ¥ï¼Œé˜²æ­¢assignedRolesä¸æ˜¯æ•°ç»„
        if (!Array.isArray(assignedRoles)) {
          return {
            satisfied: [],
            unsatisfied: demandTraits,
            score: 0,
          };
        }

        for (const role of assignedRoles) {
          const { matched } = getMatchedTraits(role.ç‰¹æ€§, demandTraits);
          matched.forEach((trait) => satisfiedTraits.add(trait));
        }

        return {
          satisfied: Array.from(satisfiedTraits),
          unsatisfied: demandTraits.filter(
            (trait) => !satisfiedTraits.has(trait)
          ),
          score: satisfiedTraits.size,
        };
      }

      // æ”¹è¿›çš„å…¨å±€ç‰¹æ€§å¹³è¡¡ä¼˜åŒ–ç®—æ³•
      function findMultiDemandSolution(selectedDemands, availableRoles) {
        const totalRolesNeeded = selectedDemands.reduce(
          (sum, demand) => sum + demand.èŒä¸šéœ€æ±‚.length,
          0
        );

        if (availableRoles.length < totalRolesNeeded) {
          return []; // è§’è‰²æ•°é‡ä¸è¶³
        }

        console.log(
          `å¼€å§‹æœç´¢æ–¹æ¡ˆï¼š${selectedDemands.length}ä¸ªéœ€æ±‚ï¼Œéœ€è¦${totalRolesNeeded}ä¸ªè§’è‰²`
        );

        // æ€§èƒ½ä¼˜åŒ–ï¼šæ ¹æ®éœ€æ±‚æ•°é‡è®¾ç½®æœç´¢é™åˆ¶
        const maxSolutions = selectedDemands.length <= 2 ? 100 : 50;
        const maxTimeMs = selectedDemands.length <= 2 ? 5000 : 3000;

        const solutions = [];
        let solutionCount = 0;
        let startTime = Date.now();

        // é¢„å¤„ç†ï¼šè®¡ç®—æ¯ä¸ªè§’è‰²å¯¹æ¯ä¸ªéœ€æ±‚çš„ç‰¹æ€§åŒ¹é…åº¦
        const roleDemandScores = {};
        selectedDemands.forEach((demand, demandIndex) => {
          roleDemandScores[demandIndex] = {};
          availableRoles.forEach((role) => {
            const matchedTraits = role.ç‰¹æ€§.filter((trait) =>
              demand.ç‰¹æ€§éœ€æ±‚.includes(trait)
            );
            roleDemandScores[demandIndex][role.index] = matchedTraits.length;
          });
        });

        // è´ªå¿ƒé¢„åˆ†é…ï¼šä¸ºæ¯ä¸ªéœ€æ±‚æ‰¾åˆ°æœ€ä½³è§’è‰²
        function greedyPreassign() {
          const assignment = Array(selectedDemands.length)
            .fill(null)
            .map(() => []);
          const usedRoles = new Set();

          // æŒ‰éœ€æ±‚æ•°é‡æ’åºï¼Œéœ€æ±‚å°‘çš„ä¼˜å…ˆ
          const demandOrder = selectedDemands
            .map((demand, index) => ({ demand, index }))
            .sort(
              (a, b) => a.demand.èŒä¸šéœ€æ±‚.length - b.demand.èŒä¸šéœ€æ±‚.length
            );

          for (const { demand, index } of demandOrder) {
            for (const job of demand.èŒä¸šéœ€æ±‚) {
              // æ‰¾åˆ°æ»¡è¶³èŒä¸šä¸”æœªä½¿ç”¨çš„æœ€ä½³è§’è‰²
              const candidates = availableRoles
                .filter(
                  (role) => role.èŒä¸š === job && !usedRoles.has(role.index)
                )
                .sort((a, b) => {
                  const aScore = roleDemandScores[index][a.index] || 0;
                  const bScore = roleDemandScores[index][b.index] || 0;
                  return bScore - aScore;
                });

              if (candidates.length > 0) {
                const selected = candidates[0];
                assignment[index].push(selected);
                usedRoles.add(selected.index);
              }
            }
          }

          return { assignment, usedRoles };
        }

        // ç‰¹æ€§äº¤æ¢ä¼˜åŒ–ï¼šå°è¯•é€šè¿‡äº¤æ¢è§’è‰²æ¥æé«˜ç‰¹æ€§åŒ¹é…åº¦
        function optimizeTraitExchange(solution) {
          let improved = true;
          let iterations = 0;
          const maxIterations = 20;

          while (improved && iterations < maxIterations) {
            improved = false;
            iterations++;

            // è®¡ç®—å½“å‰æ¯ä¸ªéœ€æ±‚çš„æœªæ»¡è¶³ç‰¹æ€§
            const unmetTraits = [];
            for (let i = 0; i < selectedDemands.length; i++) {
              const demand = selectedDemands[i];
              const assignedRoles = solution.assignment[i];
              const traitScore = calculateDemandTraitScore(
                assignedRoles,
                demand.ç‰¹æ€§éœ€æ±‚
              );
              unmetTraits[i] = traitScore.unsatisfied;
            }

            // å°è¯•æ‰€æœ‰å¯èƒ½çš„è§’è‰²äº¤æ¢
            for (let i = 0; i < selectedDemands.length; i++) {
              for (let j = 0; j < selectedDemands.length; j++) {
                if (i === j) continue;

                const demandI = selectedDemands[i];
                const demandJ = selectedDemands[j];
                const rolesI = solution.assignment[i];
                const rolesJ = solution.assignment[j];

                // å°è¯•äº¤æ¢è§’è‰²
                for (let ri = 0; ri < rolesI.length; ri++) {
                  for (let rj = 0; rj < rolesJ.length; rj++) {
                    const roleI = rolesI[ri];
                    const roleJ = rolesJ[rj];

                    // æ£€æŸ¥äº¤æ¢åæ˜¯å¦æ»¡è¶³èŒä¸šè¦æ±‚
                    if (
                      roleI.èŒä¸š !== demandJ.èŒä¸šéœ€æ±‚[rj] ||
                      roleJ.èŒä¸š !== demandI.èŒä¸šéœ€æ±‚[ri]
                    ) {
                      continue;
                    }

                    // è®¡ç®—äº¤æ¢å‰çš„ç‰¹æ€§åŒ¹é…åˆ†æ•°
                    const beforeScoreI = calculateDemandTraitScore(
                      rolesI,
                      demandI.ç‰¹æ€§éœ€æ±‚
                    ).score;
                    const beforeScoreJ = calculateDemandTraitScore(
                      rolesJ,
                      demandJ.ç‰¹æ€§éœ€æ±‚
                    ).score;
                    const beforeTotal = beforeScoreI + beforeScoreJ;

                    // åˆ›å»ºäº¤æ¢åçš„è§’è‰²åˆ—è¡¨
                    const newRolesI = [...rolesI];
                    const newRolesJ = [...rolesJ];
                    newRolesI[ri] = roleJ;
                    newRolesJ[rj] = roleI;

                    // è®¡ç®—äº¤æ¢åçš„ç‰¹æ€§åŒ¹é…åˆ†æ•°
                    const afterScoreI = calculateDemandTraitScore(
                      newRolesI,
                      demandI.ç‰¹æ€§éœ€æ±‚
                    ).score;
                    const afterScoreJ = calculateDemandTraitScore(
                      newRolesJ,
                      demandJ.ç‰¹æ€§éœ€æ±‚
                    ).score;
                    const afterTotal = afterScoreI + afterScoreJ;

                    // å¦‚æœäº¤æ¢èƒ½æé«˜æ€»ç‰¹æ€§åŒ¹é…åˆ†æ•°ï¼Œåˆ™æ‰§è¡Œäº¤æ¢
                    if (afterTotal > beforeTotal) {
                      solution.assignment[i] = newRolesI;
                      solution.assignment[j] = newRolesJ;
                      improved = true;
                      console.log(
                        `äº¤æ¢è§’è‰²ï¼š${roleI.åç§°} å’Œ ${roleJ.åç§°}ï¼Œç‰¹æ€§åŒ¹é…åº¦ä» ${beforeTotal} æé«˜åˆ° ${afterTotal}`
                      );
                      break;
                    }
                  }
                  if (improved) break;
                }
                if (improved) break;
              }
              if (improved) break;
            }
          }

          return solution;
        }

        // å›æº¯ä¼˜åŒ–ï¼šåœ¨è´ªå¿ƒç»“æœåŸºç¡€ä¸Šè¿›è¡Œä¼˜åŒ–
        function backtrack(
          demandIndex,
          currentAssignment,
          usedRoles,
          improvedScore
        ) {
          // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°é™åˆ¶
          if (
            Date.now() - startTime > maxTimeMs ||
            solutionCount >= maxSolutions
          ) {
            return;
          }

          if (demandIndex === selectedDemands.length) {
            // å®Œæˆæ‰€æœ‰éœ€æ±‚çš„åˆ†é…
            const solution = {
              assignment: [...currentAssignment],
              totalTraitScore: 0,
              demandScores: [],
            };

            // è®¡ç®—ç‰¹æ€§åŒ¹é…æƒ…å†µ
            for (let i = 0; i < selectedDemands.length; i++) {
              const demand = selectedDemands[i];
              const assignedRoles = currentAssignment[i];
              const traitScore = calculateDemandTraitScore(
                assignedRoles,
                demand.ç‰¹æ€§éœ€æ±‚
              );
              solution.demandScores.push(traitScore);
              solution.totalTraitScore += traitScore.score;
            }

            // åº”ç”¨ç‰¹æ€§äº¤æ¢ä¼˜åŒ–
            const optimizedSolution = optimizeTraitExchange(solution);

            // åªä¿å­˜æ¯”è´ªå¿ƒç»“æœæ›´å¥½çš„æ–¹æ¡ˆ
            if (optimizedSolution.totalTraitScore > improvedScore) {
              solutions.push(optimizedSolution);
              solutionCount++;
            }
            return;
          }

          const currentDemand = selectedDemands[demandIndex];
          const requiredJobs = [...currentDemand.èŒä¸šéœ€æ±‚];

          // ä¸ºå½“å‰éœ€æ±‚åˆ†é…è§’è‰²
          function assignRolesForDemand(
            jobIndex,
            assignedRoles,
            remainingUsedRoles
          ) {
            if (jobIndex === requiredJobs.length) {
              // å½“å‰éœ€æ±‚åˆ†é…å®Œæˆï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªéœ€æ±‚
              currentAssignment[demandIndex] = [...assignedRoles];
              backtrack(
                demandIndex + 1,
                currentAssignment,
                new Set(remainingUsedRoles),
                improvedScore
              );
              return;
            }

            const targetJob = requiredJobs[jobIndex];

            // æ‰¾åˆ°æ»¡è¶³èŒä¸šè¦æ±‚çš„å€™é€‰è§’è‰²
            const candidates = availableRoles.filter(
              (role) =>
                role.èŒä¸š === targetJob && !remainingUsedRoles.has(role.index)
            );

            if (candidates.length === 0) {
              return; // æ²¡æœ‰å¯ç”¨è§’è‰²ï¼Œæ”¾å¼ƒè¿™ä¸ªåˆ†æ”¯
            }

            // æŒ‰ç‰¹æ€§åŒ¹é…åº¦æ’åº
            candidates.sort((a, b) => {
              const aScore = roleDemandScores[demandIndex][a.index] || 0;
              const bScore = roleDemandScores[demandIndex][b.index] || 0;
              return bScore - aScore;
            });

            // é™åˆ¶å°è¯•æ¬¡æ•°
            const maxCandidates = Math.min(candidates.length, 3);

            for (let i = 0; i < maxCandidates; i++) {
              const candidate = candidates[i];
              const newAssignedRoles = [...assignedRoles, candidate];
              const newUsedRoles = new Set(remainingUsedRoles);
              newUsedRoles.add(candidate.index);

              assignRolesForDemand(
                jobIndex + 1,
                newAssignedRoles,
                newUsedRoles
              );

              // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°é™åˆ¶
              if (
                Date.now() - startTime > maxTimeMs ||
                solutionCount >= maxSolutions
              ) {
                break;
              }
            }
          }

          assignRolesForDemand(0, [], new Set(usedRoles));
        }

        // 1. å…ˆæ‰§è¡Œè´ªå¿ƒç®—æ³•è·å¾—åŸºç¡€è§£
        const greedyResult = greedyPreassign();

        // 2. è®¡ç®—è´ªå¿ƒè§£çš„ç‰¹æ€§åŒ¹é…åˆ†æ•°
        let greedyScore = 0;
        for (let i = 0; i < selectedDemands.length; i++) {
          const demand = selectedDemands[i];
          const assignedRoles = greedyResult.assignment[i];
          const traitScore = calculateDemandTraitScore(
            assignedRoles,
            demand.ç‰¹æ€§éœ€æ±‚
          );
          greedyScore += traitScore.score;
        }

        console.log(`è´ªå¿ƒç®—æ³•è§£ï¼šç‰¹æ€§åŒ¹é…åˆ†æ•° ${greedyScore}`);

        // 3. å°†è´ªå¿ƒè§£ä½œä¸ºåŸºå‡†è§£
        const greedySolution = {
          assignment: greedyResult.assignment,
          totalTraitScore: greedyScore,
          demandScores: [],
        };

        // è®¡ç®—è´ªå¿ƒè§£çš„éœ€æ±‚åˆ†æ•°
        for (let i = 0; i < selectedDemands.length; i++) {
          const demand = selectedDemands[i];
          const assignedRoles = greedyResult.assignment[i];
          const traitScore = calculateDemandTraitScore(
            assignedRoles,
            demand.ç‰¹æ€§éœ€æ±‚
          );
          greedySolution.demandScores.push(traitScore);
        }

        // å¯¹è´ªå¿ƒè§£åº”ç”¨ç‰¹æ€§äº¤æ¢ä¼˜åŒ–
        const optimizedGreedySolution = optimizeTraitExchange(greedySolution);
        solutions.push(optimizedGreedySolution);
        solutionCount++;

        // 4. åœ¨è´ªå¿ƒè§£åŸºç¡€ä¸Šè¿›è¡Œå›æº¯ä¼˜åŒ–
        backtrack(
          0,
          Array(selectedDemands.length)
            .fill(null)
            .map(() => []),
          new Set(),
          optimizedGreedySolution.totalTraitScore
        );

        console.log(
          `æ‰¾åˆ° ${solutions.length} ä¸ªå¯èƒ½çš„æ–¹æ¡ˆï¼Œæœç´¢æ—¶é—´ï¼š${
            Date.now() - startTime
          }ms`
        );

        // æŒ‰ç‰¹æ€§åŒ¹é…åˆ†æ•°æ’åº
        solutions.sort((a, b) => b.totalTraitScore - a.totalTraitScore);

        // å»é‡ï¼šç§»é™¤åªæ˜¯è§’è‰²é¡ºåºä¸åŒçš„é‡å¤æ–¹æ¡ˆ
        function isSameSolution(sol1, sol2) {
          // æ¯”è¾ƒæ¯ä¸ªéœ€æ±‚åˆ†é…çš„è§’è‰²é›†åˆï¼ˆä¸è€ƒè™‘é¡ºåºï¼‰
          for (let i = 0; i < selectedDemands.length; i++) {
            const roles1 = sol1.assignment[i].map(r => r.index).sort((a, b) => a - b);
            const roles2 = sol2.assignment[i].map(r => r.index).sort((a, b) => a - b);
            if (roles1.length !== roles2.length) {
              return false;
            }
            for (let j = 0; j < roles1.length; j++) {
              if (roles1[j] !== roles2[j]) {
                return false;
              }
            }
          }
          return true;
        }

        const uniqueSolutions = [];
        for (const solution of solutions) {
          let isDuplicate = false;
          for (const uniqueSolution of uniqueSolutions) {
            if (isSameSolution(solution, uniqueSolution)) {
              isDuplicate = true;
              break;
            }
          }
          if (!isDuplicate) {
            uniqueSolutions.push(solution);
          }
        }

        console.log(`å»é‡åå‰©ä½™ ${uniqueSolutions.length} ä¸ªå”¯ä¸€æ–¹æ¡ˆ`);

        // è¿”å›å‰5ä¸ªæœ€ä½³æ–¹æ¡ˆ
        return uniqueSolutions.slice(0, 5);
      }

      // ä¸»åŒ¹é…å‡½æ•°
      function matchDemands() {
        const selectedRoles = getSelectedRoles();
        const selectedDemands = getSelectedDemands();
        const resultsContainer = document.getElementById("results-container");

        // å±æ€§å›¾ç‰‡å’Œæ˜Ÿçº§å›¾ç‰‡æ˜ å°„ï¼ˆç”¨äºè¯¦æƒ…æ˜¾ç¤ºï¼‰
        const attributeImages = {
          "æ°´": "img/æ°´.png",
          "ç«": "img/ç«.png",
          "åœ°": "img/åœ°.png",
          "é£": "img/é£.png",
          "å…‰": "img/å…‰.png",
          "æš—": "img/æš—.png"
        };
        
        const starImages = {
          "å››æ˜Ÿ": "img/å››æ˜Ÿ.png",
          "äº”æ˜Ÿ": "img/äº”æ˜Ÿ.png"
        };

        resultsContainer.innerHTML = "";

        if (selectedDemands.length === 0) {
          resultsContainer.innerHTML =
            '<div class="no-solution">è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªéœ€æ±‚</div>';
          return;
        }

        const totalRolesNeeded = selectedDemands.reduce(
          (sum, demand) => sum + demand.èŒä¸šéœ€æ±‚.length,
          0
        );

        if (selectedRoles.length < totalRolesNeeded) {
          resultsContainer.innerHTML = `<div class="no-solution">å¯ç”¨è§’è‰²æ•°é‡ä¸è¶³ï¼Œéœ€è¦ ${totalRolesNeeded} ä¸ªè§’è‰²ï¼Œå½“å‰åªæœ‰ ${selectedRoles.length} ä¸ª</div>`;
          return;
        }

        // æ˜¾ç¤ºæœç´¢çŠ¶æ€
        resultsContainer.innerHTML =
          '<div style="color: #667eea; margin-bottom: 20px; text-align: center; padding: 20px; font-size: 1.1em;"><span class="loading"></span> æ­£åœ¨æœç´¢æœ€ä½³åŒ¹é…æ–¹æ¡ˆ...</div>';

        // ä¸ºå¤šä¸ªéœ€æ±‚å¯»æ‰¾æœ€ä½³åŒ¹é…æ–¹æ¡ˆ
        const solutions = findMultiDemandSolution(
          selectedDemands,
          selectedRoles
        );

        resultsContainer.innerHTML = "";

        if (solutions.length === 0) {
          resultsContainer.innerHTML =
            '<div class="no-solution">æ— æ³•æ‰¾åˆ°æ»¡è¶³æ‰€æœ‰éœ€æ±‚çš„è§’è‰²ç»„åˆæ–¹æ¡ˆ</div>';
          return;
        }

        // è®¡ç®—æœ€ä¼˜æ–¹æ¡ˆæ•°é‡ï¼ˆå®Œå…¨æ»¡è¶³çš„æ–¹æ¡ˆï¼‰
        const perfectSolutionsCount = solutions.filter(solution => {
          return solution.demandScores.every(
            (score) =>
              score.satisfied.length === selectedDemands[0].ç‰¹æ€§éœ€æ±‚.length
          );
        }).length;

        // æ˜¾ç¤ºæœ€ä½³æ–¹æ¡ˆ
        solutions.forEach((solution, solutionIndex) => {
          const solutionDiv = document.createElement("div");
          solutionDiv.className = "total-solution";

          // æ£€æŸ¥æ˜¯å¦ä¸ºå®Œå…¨æ»¡è¶³çš„æ–¹æ¡ˆ
          const isPerfectSolution = solution.demandScores.every(
            (score) =>
              score.satisfied.length === selectedDemands[0].ç‰¹æ€§éœ€æ±‚.length
          );

          let solutionHTML = `
                    <div class="solution-header">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span>${isPerfectSolution ? "æœ€ä¼˜æ–¹æ¡ˆ" : "æ¬¡ç­‰æ–¹æ¡ˆ"} ${solutionIndex + 1}</span>
                            ${isPerfectSolution ? `<span style="color: #718096; font-size: 0.85em; font-weight: normal;">å…± ${perfectSolutionsCount} ä¸ªæœ€ä¼˜æ–¹æ¡ˆ</span>` : ''}
                        </div>
                    </div>
                `;

          // æ£€æŸ¥è§’è‰²ä½¿ç”¨æƒ…å†µ
          const usedRoles = new Set();
          let hasDuplicate = false;

          selectedDemands.forEach((demand, demandIndex) => {
            const assignedRoles = solution.assignment[demandIndex];
            const traitScore = solution.demandScores[demandIndex];

            // æ£€æŸ¥è§’è‰²é‡å¤ä½¿ç”¨ï¼ˆæ·»åŠ æ•°ç»„æ£€æŸ¥ï¼‰
            if (Array.isArray(assignedRoles)) {
              assignedRoles.forEach((role) => {
                if (usedRoles.has(role.index)) {
                  hasDuplicate = true;
                }
                usedRoles.add(role.index);
              });
            }

            // æ˜¾ç¤ºéœ€æ±‚ç‰¹æ€§åŒ¹é…æƒ…å†µ
            let traitDisplay = "";
            demand.ç‰¹æ€§éœ€æ±‚.forEach((trait) => {
              const isMatched = traitScore.satisfied.includes(trait);
              traitDisplay += `<span class="trait-badge ${isMatched ? 'matched' : 'unmatched'}">${trait}</span>`;
            });

            // ç”Ÿæˆè§’è‰²å›¾ç‰‡åˆ—è¡¨
            let roleImagesHTML = '';
            if (Array.isArray(assignedRoles)) {
              assignedRoles.forEach((role) => {
                const roleAvatarNames = [
                  `img/${role.åç§°}.png`,
                  `img/${role.åç§°}.jpg`,
                  `img/${role.åç§°}.jpeg`,
                  `img/${role.åç§°}_avatar.png`,
                  `img/${role.åç§°}_å¤´åƒ.png`
                ];
                const roleAvatar = roleAvatarNames[0];
                roleImagesHTML += `<img src="${roleAvatar}" alt="${role.åç§°}" class="result-role-avatar" data-role-name="${role.åç§°}" onerror="handleAvatarError(this);">`;
              });
            }

            // ç”ŸæˆèŒä¸šéœ€æ±‚æ˜¾ç¤ºï¼Œæ£€æŸ¥åŒ¹é…çŠ¶æ€
            let jobDisplay = "";
            if (Array.isArray(assignedRoles) && assignedRoles.length > 0) {
              // è·å–å·²åˆ†é…è§’è‰²çš„èŒä¸šåˆ—è¡¨
              const assignedJobs = assignedRoles.map(role => role.èŒä¸š);
              // åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ç”¨äºè·Ÿè¸ªå·²åŒ¹é…çš„èŒä¸š
              const availableJobs = [...assignedJobs];
              
              // æ£€æŸ¥æ¯ä¸ªèŒä¸šéœ€æ±‚æ˜¯å¦åŒ¹é…
              demand.èŒä¸šéœ€æ±‚.forEach((requiredJob, jobIndex) => {
                // æŸ¥æ‰¾æ˜¯å¦æœ‰åŒ¹é…çš„èŒä¸šï¼ˆä¼˜å…ˆæ£€æŸ¥å¯¹åº”ä½ç½®ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨åŒ¹é…ï¼‰
                let isMatched = false;
                // é¦–å…ˆæ£€æŸ¥å¯¹åº”ä½ç½®æ˜¯å¦åŒ¹é…
                if (jobIndex < assignedJobs.length && assignedJobs[jobIndex] === requiredJob) {
                  isMatched = true;
                  // ä»å¯ç”¨åˆ—è¡¨ä¸­ç§»é™¤å¯¹åº”ä½ç½®çš„èŒä¸š
                  if (jobIndex < availableJobs.length) {
                    availableJobs.splice(jobIndex, 1);
                  }
                } else {
                  // æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä½ç½®çš„è§’è‰²èŒä¸šåŒ¹é…
                  const matchIndex = availableJobs.indexOf(requiredJob);
                  if (matchIndex !== -1) {
                    isMatched = true;
                    // ç§»é™¤å·²åŒ¹é…çš„èŒä¸šï¼Œé¿å…é‡å¤åŒ¹é…
                    availableJobs.splice(matchIndex, 1);
                  }
                }
                jobDisplay += `<span class="trait-badge ${isMatched ? 'matched' : 'unmatched'}">${requiredJob}</span> `;
              });
            } else {
              // å¦‚æœæ²¡æœ‰åˆ†é…è§’è‰²ï¼Œæ‰€æœ‰èŒä¸šéœ€æ±‚éƒ½ä¸åŒ¹é…
              demand.èŒä¸šéœ€æ±‚.forEach((requiredJob) => {
                jobDisplay += `<span class="trait-badge unmatched">${requiredJob}</span> `;
              });
            }
            jobDisplay = jobDisplay.trim();
            
            let demandHTML = `
                        <div class="demand-assignment">
                            <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin-bottom: 8px;">
                                <strong>${demand.ç‰©å“åç§°}</strong>
                                <span style="color: #718096; font-size: 0.9em;">éœ€è¦ç‰¹æ€§:</span>
                                ${traitDisplay}
                                <span style="color: #718096; font-size: 0.9em; margin-left: 8px;">èŒä¸šéœ€æ±‚:</span>
                                ${jobDisplay}
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                                ${roleImagesHTML}
                            </div>
                        </div>
                    `;
            solutionHTML += demandHTML;
          });

          if (hasDuplicate) {
            solutionHTML +=
              '<div style="color: #742a2a; background: #fed7d7; padding: 10px; margin-top: 12px; border-radius: 6px; font-size: 0.9em;">è­¦å‘Šï¼šå­˜åœ¨è§’è‰²é‡å¤ä½¿ç”¨</div>';
          }
          solutionDiv.innerHTML = solutionHTML;
          solutionDiv.setAttribute('data-solution-index', solutionIndex);
          resultsContainer.appendChild(solutionDiv);
        });
      }

      // åˆ‡æ¢æ–¹æ¡ˆè¯¦æƒ…æ˜¾ç¤º

      // è®¾ç½®èƒŒæ™¯å›¾ç‰‡
      function setBackgroundImage() {
        // å°è¯•å¤šç§å¯èƒ½çš„æ–‡ä»¶åæ ¼å¼
        const possibleNames = [
          'img/4028_B #1616580.png',
          'img/4028_B%20%231616580.png',
          'img/4028_B_1616580.png',
          'img/4028_B.png',
          './img/4028_B #1616580.png',
          'img\\4028_B #1616580.png'
        ];
        
        let index = 0;
        const tryNext = () => {
          if (index < possibleNames.length) {
            const testImg = new Image();
            testImg.onload = () => {
              const imgPath = possibleNames[index];
              document.body.style.backgroundImage = `url('${imgPath}')`;
              document.body.style.backgroundPosition = 'center center';
              document.body.style.backgroundSize = 'cover';
              document.body.style.backgroundRepeat = 'no-repeat';
              document.body.style.backgroundAttachment = 'fixed';
              console.log('èƒŒæ™¯å›¾ç‰‡åŠ è½½æˆåŠŸ:', imgPath);
            };
            testImg.onerror = () => {
              index++;
              tryNext();
            };
            testImg.src = possibleNames[index];
          } else {
            console.warn('æ— æ³•åŠ è½½èƒŒæ™¯å›¾ç‰‡ï¼Œè¯·æ£€æŸ¥ img æ–‡ä»¶å¤¹ä¸­æ˜¯å¦å­˜åœ¨ 4028_B #1616580.png');
          }
        };
        tryNext();
      }

      // è®¾ç½®è§’è‰²å›¾æ ‡
      function setRoleIcon() {
        const roleIcon = document.querySelector('.role-icon');
        if (!roleIcon) return;
        
        const possibleNames = [
          'img/btn_icon_system_Gacha #2000653.png',
          'img/btn_icon_system_Gacha%20%232000653.png',
          'img/btn_icon_system_Gacha_2000653.png',
          'img/btn_icon_system_Gacha.png',
          './img/btn_icon_system_Gacha #2000653.png'
        ];
        
        let index = 0;
        const tryNext = () => {
          if (index < possibleNames.length) {
            const testImg = new Image();
            testImg.onload = () => {
              roleIcon.src = possibleNames[index];
              console.log('è§’è‰²å›¾æ ‡åŠ è½½æˆåŠŸ:', possibleNames[index]);
            };
            testImg.onerror = () => {
              index++;
              tryNext();
            };
            testImg.src = possibleNames[index];
          } else {
            console.warn('æ— æ³•åŠ è½½è§’è‰²å›¾æ ‡ï¼Œè¯·æ£€æŸ¥ img æ–‡ä»¶å¤¹ä¸­æ˜¯å¦å­˜åœ¨ btn_icon_system_Gacha #2000653.png');
          }
        };
        tryNext();
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      window.onload = function() {
        setBackgroundImage();
        setRoleIcon();
        initializePage();
      };
    </script>
  </body>
</html>

